{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="mt-4 text-center">{{ quiz.name }}</h2>

    <div class="d-flex justify-content-between">
        <h5>Question {{ q_index + 1 }} of {{ quiz.total_qsn }}</h5>
        <h5 class="text-danger">Time Left: <span id="timer">{{ remaining_time }}</span> seconds</h5>
    </div>

    <div class="card p-3 mt-3">
        <h4>{{ question.question_statement }}</h4>

        <form method="POST" action="{{ url_for('app_routes.navigate_question', quiz_id=quiz.id, q_index=q_index) }}">
            <input type="hidden" name="time_left" id="time_left_input" value="{{ remaining_time }}">
            
            <div class="form-check">
                <input class="form-check-input" type="radio" name="option" value="option1" required>
                <label class="form-check-label">{{ question.option1 }}</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="option" value="option2">
                <label class="form-check-label">{{ question.option2 }}</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="option" value="option3">
                <label class="form-check-label">{{ question.option3 }}</label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio" name="option" value="option4">
                <label class="form-check-label">{{ question.option4 }}</label>
            </div>

            <div class="mt-3">
                {% if q_index > 0 %}
                    <button type="submit" name="direction" value="prev" class="btn btn-secondary">Previous</button>
                {% endif %}

                {% if q_index < quiz.total_qsn - 1 %}
                    <button type="submit" name="direction" value="next" class="btn btn-primary">Next</button>
                {% else %}
                    <button type="submit" name="direction" value="submit" class="btn btn-success">Submit Quiz</button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for Countdown Timer -->
<script>
    let timeLeft = {{ remaining_time | default=(0) }}; // Get time from Flask
    const timerElement = document.getElementById("timer");
    const timeLeftInput = document.getElementById("time_left_input");

    function updateTimer() {
        if (timeLeft > 0) {
            timeLeft--;
            timerElement.textContent = timeLeft;
            timeLeftInput.value = timeLeft; // Update hidden input field
        } else {
            // Auto-submit when time is up
            window.location.href = "{{ url_for('app_routes.submit_quiz', quiz_id=quiz.id) }}";
        }
    }

    setInterval(updateTimer, 1000); // Decrease time every second
</script>

{% endblock %}
